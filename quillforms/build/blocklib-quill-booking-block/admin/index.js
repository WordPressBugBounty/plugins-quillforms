(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{blockAdminSettings:()=>m});const n=window.qf.blocks,l=window.qf.adminComponents,o=window.qf.config;var a=e.n(o);const i=window.wp.element,r=window.wp.data,c=window.wp.i18n,s=window.wp.apiFetch;var d=e.n(s);const{name:u}={name:"quill-booking",attributes:{eventId:{type:"string",default:""},username:{type:"object",default:{}},email:{type:"object",default:{}},scheduleText:{type:"string",default:"Schedule"},alreadyScheduledText:{type:"string",default:"Your Quill Booking is scheduled successfully!"}},supports:{editable:!0,required:!0,description:!0,theme:!0,logic:!1,attachment:!1},logicalOperators:["is","is_not","greater_than","lower_than"]},m={color:"#45B7D1",icon:()=>React.createElement("svg",{viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"},React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7 2a1 1 0 011 1v1h8V3a1 1 0 112 0v1h1a3 3 0 013 3v12a3 3 0 01-3 3H5a3 3 0 01-3-3V7a3 3 0 013-3h1V3a1 1 0 011-1zm11 3H6v1a1 1 0 11-2 0V5H5a1 1 0 00-1 1v3h16V6a1 1 0 00-1-1h-1v1a1 1 0 11-2 0V5zm2 6H4v8a1 1 0 001 1h14a1 1 0 001-1v-8zm-9 2a1 1 0 011 1v3a1 1 0 11-2 0v-3a1 1 0 011-1z"})),title:"Quill Booking",controls:e=>{const{id:t,attributes:{eventId:n,username:o,email:s,scheduleText:u,alreadyScheduledText:m},setAttributes:p}=e,[g,f]=(0,i.useState)([]),[v,h]=(0,i.useState)(!1),[_,b]=(0,i.useState)("checking"),{setFieldAnswer:y,setIsFieldAnswered:k,setIsFieldValid:E,setFieldValidationErr:w}=(0,r.useDispatch)("quillForms/renderer-core");(0,i.useEffect)((()=>{(async()=>{let e="checking";try{h(!0);try{const t=(await d()({path:"wp/v2/plugins"})).find((e=>e.plugin&&(e.plugin.includes("quillbooking")||e.name.toLowerCase().includes("quillbooking"))));if(!t)throw e="not_installed",b(e),new Error("Plugin not installed");if("active"!==t.status)throw e="inactive",b(e),new Error("Plugin not active");e="active",b(e)}catch(t){if("checking"!==e)throw t;try{await d()({path:"qb/v1/events?per_page=1"}),e="active",b(e)}catch(e){throw e}}const t=await d()({path:"qb/v1/events?per_page=100&filter[user]=all"}),n=[];if(t&&t.data){n.push({key:"",name:(0,c.__)("Select an event","quillforms")});const e={};t.data.forEach((t=>{const n=t.calendar?t.calendar.name:`Calendar ${t.calendar_id}`;e[n]||(e[n]=[]),e[n].push({key:t.id.toString(),name:t.name})})),Object.keys(e).forEach((t=>{n.push({key:`section-${t}`,name:React.createElement("div",{onClick:e=>e.stopPropagation(),style:{fontWeight:"bold",textDecoration:"underline"}},t),className:"event-select-section"}),e[t].forEach((e=>{n.push({key:e.key,name:React.createElement("div",{style:{paddingLeft:"15px"}},e.name)})}))}))}1===n.length&&n.push({key:"no-events",name:React.createElement("div",{style:{padding:"10px",textAlign:"center",color:"#666",pointerEvents:"none"}},React.createElement("div",null,(0,c.__)("No calendars or events found","quillforms")),React.createElement("div",{style:{marginTop:"5px",fontSize:"12px"}},React.createElement("a",{href:"#",style:{color:"#007cba",textDecoration:"underline",cursor:"pointer",pointerEvents:"auto"},onClick:e=>{e.preventDefault(),e.stopPropagation(),window.open(`${a().getAdminUrl()}admin.php?page=quillbooking&path=calendars`,"_blank")}},(0,c.__)("Create calendar and event","quillforms")))),disabled:!0,selectable:!1}),f(n)}catch(t){let n="checking"===e?"inactive":e,l=(0,c.__)("QuillBooking plugin is not active","quillforms"),o=(0,c.__)("Go to Plugins","quillforms"),i=`${a().getAdminUrl()}plugins.php`;"rest_no_route"===t.code||"not_installed"===e?(n="not_installed",l=(0,c.__)("QuillBooking plugin is not installed","quillforms"),o=(0,c.__)("Install QuillBooking Plugin","quillforms"),i=`${a().getAdminUrl()}plugin-install.php?s=quillbooking&tab=search&type=term`):"rest_cannot_access"===t.code||"rest_forbidden"===t.code?(n="no_permission",l=(0,c.__)("No permission to access QuillBooking API","quillforms"),o=(0,c.__)("Check Permissions","quillforms"),i=`${a().getAdminUrl()}users.php`):"rest_cookie_invalid_nonce"===t.code||"rest_not_logged_in"===t.code?(n="no_permission",l=(0,c.__)("Authentication required for QuillBooking API","quillforms"),o=(0,c.__)("Refresh Page","quillforms"),i=window.location.href):"inactive"===e&&(n="inactive",l=(0,c.__)("QuillBooking plugin is not active","quillforms"),o=(0,c.__)("Go to Plugins","quillforms"),i=`${a().getAdminUrl()}plugins.php`),e=n,b(n),f([{key:"",name:(0,c.__)("Select an event","quillforms")},{key:`plugin-${n}`,name:React.createElement("div",{style:{padding:"10px",textAlign:"center",color:"#d63638",pointerEvents:"none"}},React.createElement("div",null,l),React.createElement("div",{style:{marginTop:"5px",fontSize:"12px"}},React.createElement("a",{href:"#",style:{color:"#007cba",textDecoration:"underline",cursor:"pointer",pointerEvents:"auto"},onClick:e=>{e.preventDefault(),e.stopPropagation(),window.open(i,"_blank")}},o))),disabled:!0,selectable:!1}])}finally{h(!1)}})()}),[]);const C=({sections:e,options:t})=>{try{const n=Array.isArray(e)?e:[],l=Array.isArray(t)?t:[];return{sections:n.filter((e=>e&&e.key&&["fields","hidden_fields"].includes(e.key))),options:l.filter((e=>e&&e.type&&["field","hidden_field"].includes(e.type)))}}catch(e){return{sections:[],options:[]}}},R=()=>{y(t,null),E(t,!0),k(t,!1),w(t,null)};return React.createElement(i.Fragment,null,React.createElement(l.BaseControl,null,React.createElement(l.ControlWrapper,{orientation:"vertical"},React.createElement(l.ControlLabel,{label:(0,c.__)("Event","quillforms")}),React.createElement(l.SelectControl,{value:g.find((e=>e.key===n))||g[0],onChange:({selectedItem:e})=>{e&&e.key&&!e.key.startsWith("section-")&&"no-events"!==e.key&&"error"!==e.key&&!e.key.startsWith("plugin-")&&(R(),p({eventId:e.key}))},options:g}))),React.createElement(l.BaseControl,null,React.createElement(l.ControlLabel,{label:(0,c.__)("Prefill info","quillforms")}),React.createElement(l.ControlWrapper,{orientation:"vertical"},React.createElement(l.ControlLabel,{label:(0,c.__)("Name","quillforms")}),React.createElement(l.ComboboxControl,{value:o,onChange:e=>{R(),p({username:e})},customize:C,isToggleEnabled:!1})),React.createElement(l.ControlWrapper,{orientation:"vertical"},React.createElement(l.ControlLabel,{label:(0,c.__)("Email","quillforms")}),React.createElement(l.ComboboxControl,{value:s,onChange:e=>{R(),p({email:e})},customize:C,isToggleEnabled:!1}))),React.createElement(l.BaseControl,null,React.createElement(l.ControlWrapper,{orientation:"vertical"},React.createElement(l.ControlLabel,{label:(0,c.__)("Schedule button text in mobile","quillforms")}),React.createElement(l.TextControl,{value:u,onChange:e=>{R(),p({scheduleText:e})}}))),React.createElement(l.BaseControl,null,React.createElement(l.ControlWrapper,{orientation:"vertical"},React.createElement(l.ControlLabel,{label:(0,c.__)("Already scheduled text in mobile","quillforms")}),React.createElement(l.TextControl,{value:m,onChange:e=>{R(),p({alreadyScheduledText:e})}}))))},order:3};(0,n.setBlockAdminSettings)(u,m),(window.qf=window.qf||{}).blocklibQuillBookingBlockAdmin=t})();